#####################################
Replace-HeaderFooter.ps1開発メモ
#####################################

概要
========
ファイルで指定されたExcelファイル群の全シートのヘッダーとフッターを変換するps1スクリプト。
通常動作では、既に設定済みである場合はファイルの変更は行わない安心設計（のはず）。

{Left,Center,Right}x{Header,Footer}の設定が可能。

オプション
=============

* ``- ReplaceHFFileList filename``: 設定したいヘッダー・フッターの値と設定対象ファイルのリストが書かれたファイルをfilenameで指定する。filename内のフォーマットは設定したいヘッダー・フッターの内容を1行目に、2行目以降に設定対象のエクセルファイルを列記する。1行目のフォーマットはTheader-left,header-center,header-right,footer-left,footer-center,foot-rightをTSVで記載したものとなる。デフォルト値は ``.\replaceHeaderFooterFile.lst``。

* ``-Debug``: 本オプションを指定して実行した場合、Excelウィンドウを表示しながら動作するようになる。
* ``-Dryrun``: 実際に変換が発生するかどうかだけを表示し、実際の変更は行わない。

Disclaimer
=================

* Powershell 2.0 と KingOffice で動作確認したのでExcelだと何か問題があるかもしれない。
* ExcelをCom経由で操作して動作するためExcelがインストールされていない環境では動作しない。

仕様メモ
=================

このあたりバッドノウハウ的な対処をしている部分もあるかもしれないので注意。

* 既に設定対象になっている場合は変更をしない。

* 値に使える特殊文字とかはvbaの仕様に順ずるようだ。（ちゃんと調べてない。)

* 最初変換対象のセル範囲は UsedRange としていたが、何かの間違いで巨大なエクセルを処理するとPowerShellがハングして恐ろしいので``A1:K12``でハードコーディングしてある。

* たまにエクセルがロックされてしまう事があった。finally区でちゃんとReleaseComObjectしてる。

* Comオブジェクトにファイルを開かせようとすると、実行した場所ではなく実行ユーザのホームディレクトリがカレントに見えるらしいのでフルPATHで無い場合はフルPATHに直す処理をいれている。

* 何も考えずに echo とか write-host cmdletで出力をしている。ちゃんとloggingしたいけどまあ良いか。

* paramの[switch]は指定していないときに$Falseが入っているのかちゃんと調べていないので、Bool値受け渡し用の変数を設定している（が、ちゃんと仕様を調べて無駄な変数とか無くせるなら無くしたい。）

vim: ft=rst tw=0:
